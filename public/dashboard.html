<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoBoard</title>
    <link rel="stylesheet" href="css/index.css">
    <link rel="stylesheet" href="./css/dashboard.css">
</head>

<body>
    <!-- Updated Navbar -->
    <nav class="navbar">
        <div class="dashboard-title">
          <h1>Dashboard</h1>
        </div>
        <div class="left-nav">
          <img src="./src/assets/icons8-user-50.png" alt="">
        </div>
    </nav>

    <div class="sidebar">
        <div class="menu">
          <div class="item"><a href="./index.html" class="sub-item">My Account</a></div>
          <div class="item"><a href="#">Bill Payments</a></div>
          <div class="item"><a href="#">Transfer Funds</a></div>
          <div class="item">
            <a href="" id="ecoCreditBtn" class="sub-btn">EcoCredit</a>
            <div id="ecoCreditSubMenu" class="sub-menu" style="display: none;">
              <a href="./dashboard.html" class="sub-item">Dashboard</a>
              <a href="./achievement.html" class="sub-item">Achievement</a>
              <a href="./trends.html" class="sub-item">Trends</a>
              <a href="./leaderboard.html" class="sub-item">Leaderboard</a>
            </div>
          </div>
        </div>
      </div>

    <div class="main" style="margin-left: [appropriate value];">
        <h1>Sustainability Tracker</h1>
        <div class="row1">
            <div class="progress-card">
                <h4>Progress Bar</h4>
                <div class="chart-border">
                    <img src="Goal_for_this_month.png" style="width: 300px; height: auto;"></img>
                </div>
            </div>
            <div class="eco-points">
                <h4>Your EcoPoints:</h4>
                <p>1008</p>
            </div>
        </div>
        <div class="row2">
            <div class="pie-chart">
                <h4>Total Money Spent:</h4>
                <div class="chart-border">
                    <canvas id="pie-chart"></canvas>
                </div>
            </div>
            <div class="bar-graph">
                <h4>Points (per month)</h4>
                <div class="chart-border">
                    <canvas id="bar-chart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <!-- Common scripts -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script>
        let pie_chart_labels = ["Sustainable Products", "Non-sustainable Products"];
        let bar_chart_labels = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"]
        let totalSpending, totalSustainableSpending, totalEcoPoints;    
    
        document.addEventListener('DOMContentLoaded', function() {
            var ecoCreditBtn = document.getElementById('ecoCreditBtn');
            var ecoCreditSubMenu = document.getElementById('ecoCreditSubMenu');
        
            ecoCreditBtn.addEventListener('click', function(event) {
                event.preventDefault(); // Prevent the default link behavior
                var display = ecoCreditSubMenu.style.display;
                ecoCreditSubMenu.style.display = display === 'block' ? 'none' : 'block';
            });

            var csvfile = "./sample-spending.csv";  
            Papa.parse(csvfile, {
                header: true,
                download: true,
                complete: function (results) {
                    // 2D array with all transactions
                    data = results.data;
                    console.log(data);

                    // EcoPoints
                    totalEcoPoints = data.reduce((accumulator, item) => {
                        // Check if the 'EcoPoints' property exists and is a valid number
                        if (item.EcoCredit !== undefined && !isNaN(parseFloat(item.EcoCredit))) {
                            // Add 'EcoCredit' value to the accumulator
                            accumulator += parseFloat(item.EcoCredit);
                        }
                        return accumulator;
                    }, 0);

                    let ecoPointsParagraph = document.querySelector('.eco-points p');

                    ecoPointsParagraph.textContent = totalEcoPoints.toString();

                    // Pie Chart
                    totalSpending = data.reduce((accumulator, { Amount }) => accumulator + parseInt(Amount), 0);
                    totalSustainableSpending = data.reduce((accumulator, item) => {
                        // Check if the 'EcoCredit' property exists and is a valid number
                        if (item.EcoCredit !== undefined && !isNaN(parseFloat(item.EcoCredit))) {
                            // If 'EcoCredit' is greater than or equal to 2, add it to the accumulator
                            // Otherwise, add 0 to the accumulator
                            accumulator += (parseFloat(item.EcoCredit) >= 2) ? parseFloat(item.EcoCredit) : 0;
                        }
                        return accumulator;
                    }, 0);
                    
                    new Chart(document.getElementById('pie-chart'), {
                        type: 'pie',
                        data: {
                            labels: pie_chart_labels,
                            datasets: [{
                                backgroundColor: ["#e66346", "#254BD0", "#ffbe0b"],
                                data: [totalSpending, totalSustainableSpending]
                            }]
                        }
                    })

                    new Chart(document.getElementById('bar-chart'), {
                        type: 'bar',
                        data: {
                            labels: bar_chart_labels,
                            datasets: [{
                                backgroundColor: ["#e66346", "#254BD0", "#ffbe0b"],
                                data: [343, 434, 123, 436, 564, 745, 454, 676, 234, 324, 565, 0]
                            }]
                        }
                    })
                }
            })

        });

    </script>
</body>
</html>